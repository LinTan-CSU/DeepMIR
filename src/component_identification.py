# -*- coding:utf-8 -*-
from Dataset import Dataset
import torch.utils.data as data
import torch
from DeepMIR import Model
import csv
import numpy as np


model_path = '../model/DeepMIR.pth'
test_dataset = Dataset('../data/reftest_component_identification_200_noised_10%_mirrored.npy')
test_dataloader = data.DataLoader(test_dataset, shuffle=False, batch_size=200)
state_dict = torch.load(model_path)
model = Model()
model.load_state_dict(state_dict)
model.eval()
#200
lib = ['(+)-Arabinogalactan, Larch gum', '(-)-1,3,3-Trimethylbicyclo[2.2.1]heptan-2-one, (-)-Fenchone', '(1R)-(+)-1,7,7-Trimethylbicyclo[2.2.1]heptan-2-one, (1R)-(+)-Camphor', '(1R)-(-)-6,6-Dimethylbicyclo[3.1.1]hept-2-ene-1-carboxaldehyde, (1R)-(-)-Myrtena', '(1S)-(-)-6,6-Dimethyl-2-methylenebicyclo[3.1.1]heptane, b-Pinene', '(1S,2S,5R)-(+)-2-Isopropyl-5-methylcyclohexanol, (+)-Neomenthol', '(2S,5R)-(-)-2-Isopropyl-5-methylcyclohexanone, (2S,5R)-(-)-Menthone', '(E)-2-Ethoxy-5-propenylphenol, Propenyl guaethol', '(E)-2-Heptenal', '(E)-2-Hexen-1-ol', '(E)-2-Hexenal', '(E)-2-Hexenoic acid', '(E)-2-Methyl-2-butenoic acid, Tiglic acid', '(E)-2-Nonenal', '(E)-3,7-Dimethyl-2,6-octadien-1-ol, Geraniol', '(E)-3-Hexen-1-ol', '(E)-3-Hexenoic acid', '(E)-4-(1-Propenyl)anisole, (E)-Anethole', '(E)-4-Phenyl-3-buten-2-one, Benzalacetone', '(E)-Aconitic acid, (E)-1-Propene-1,2,3-tricarboxylic acid', '(E)-Cinnamaldehyde, (E)-3-Phenylpropenal', '(E,E)-2,4-Heptadienal', '(E,E)-2,4-Hexadienal, Sorbic aldehyde', '(E,E)-2,4-Nonadienal', '(R)-(+)-4-Isopropenyl-1-methyl-1-cyclohexene, Limonene, p-Mentha-1,8-diene', '(S)-(+)-5-Isopropenyl-2-methyl-2-cyclohexen-1-one, (+)-Carvone, p-Mentha-6,8-die', '(Z)-2-Hexen-1-ol', '(Z)-3,7-Dimethyl-2,6-octadien-1-ol, Nerol', '(Z)-3-Hexen-1-ol', '(Z)-3-Hexen-1-yl acetate', '(Z)-9-Octadecenoic acid, Oleic acid', '1,1-Dimethoxy-2-phenylethane, Phenylacetaldehyde dimethyl acetal', '1,1-Dimethoxyethane, Acetaldehyde dimethyl acetal', '1,2-Cyclohexanedione, 2-Hydroxy-2-cyclohexen-1-one', '1,2-Dimethoxy-4-(1-propenyl)benzene, Isoeugenyl methyl ether', '1,2-Ethanedithiol', '1,2-Propanediol, Propylene glycol', '1,2-Propanedithiol', '1,3,3-Trimethylbicyclo[2.2.1]heptan-2-ol, Fenchol, Fenchyl alcohol', '1,3,7-Trimethylxanthine, Caffeine', '1,3-Dihydroxybenzene, Resorcinol', '1,3-Dimethoxybenzene, Resorcinol dimethyl ether', '1,3-Diphenyl-2-propanone, 1,3-Diphenylacetone', '1,3-Propanedithiol', '1,4-Dimethoxybenzene, Hydroquinone dimethyl ether', '1,6-Hexanedithiol', '1,8-Epoxy-p-menthane, 1,8-Cineole, Eucalyptol', '1,9-Nonanedithiol, 1,9-Dimercaptononane', '1-(3,4-Methylenedioxybenzyl)piperidine, Piperine, N-Piperonylpiperidine', "1-(4-Hydroxyphenyl)-3-butanone, 4'-Hydroxybenzylacetone", '1-(4-Methoxyphenyl)-2-propanone, p-Methoxyphenylacetone', '1-Butanethiol, Butyl mercaptan', '1-Butanol, Butyl alcohol', '1-Decanol, Decyl alcohol', '1-Dodecanol, Lauryl alcohol', '1-Heptanol, Heptyl alcohol', '1-Hexadecanol, Cetyl alcohol', '1-Hexanol, Hexyl alcohol', '1-Hexen-3-ol', '1-Isopropyl-4-methyl-1,3-cyclohexadiene, p-Mentha-1,3-diene, a-Terpinene', '1-Isopropyl-4-methyl-1,4-cyclohexadiene, p-Mentha-1,4-diene, g-Terpinene', '1-Isopropyl-4-methyl-3-cyclohexen-1-ol, 4-Carvomenthol, 4-Terpinenol, p-Menth-1-', '1-Methylnaphthalene', '1-Nonanol, Nonyl alcohol', '1-Octanol, Octyl alcohol', '1-Octen-3-ol', '1-Pentanol, Amyl alcohol', '1-Penten-3-ol', '1-Penten-3-one, Ethyl vinyl ketone', '1-Phenyl-1,2-propanedione, Methyl phenyl glyoxal', '1-Phenyl-1-propanol', '1-Phenyl-2-pentanol, 1-Benzyl-1-butanol, a-Propylphenethyl alcohol', '1-Propanethiol, Propyl mercaptan', '1-Propanol, Propyl alcohol', '1-Undecanol, 1-Hendecanol', "2',4'-Dihydroxyacetophenone", "2',5'-Dihydroxyacetophenone", "2',6'-Dihydroxyacetophenone", "2'-Acetonaphthone, 2-Acetylnaphthalene", "2'-Hydroxyacetophenone, o-Acetylphenol", '2,2,6-Trimethylcyclohexanone', '2,2-Dimethyl-3-methylenebicyclo[2.2.1]heptane, Camphene', '2,3,5,6-Tetramethylpyrazine', '2,3,5-Trimethylpyrazine', '2,3-Butanedione, Diacetyl', '2,3-Dimethylpyrazine', '2,3-Hexanedione', '2,3-Pentanedione', '2,4-Dimethylbenzaldehyde', '2,5-Dimethylphenol, 2,5-Xylenol', '2,5-Dimethylpyrazine', '2,6,6-Trimethylbicyclo[3.1.1]hept-2-ene, a-Pinene', '2,6-Dimethoxyphenol, Syringol', '2,6-Dimethyl-4-heptanone, Diisobutyl ketone', '2,6-Dimethylphenol, 2,6-Xylenol', '2,6-Dimethylpyrazine', '2,6-Dimethylpyridine, 2,6-Lutidine', '2-(Methyl)thiophenol, o-Thiocresol, o-Toluenethiol', '2-Acetyl-1-methylpyrrole', '2-Acetylfuran', '2-Acetylpyridine', '2-Acetylpyrrole', '2-Butanone', '2-Ethyl-1-hexanol', '2-Ethylbutyraldehyde, 2-Ethylbutanal', '2-Ethylbutyric acid', '2-Ethylfuran', '2-Ethylpyrazine', '2-Furaldehyde, Furfural', '2-Heptanol', '2-Heptanone', '2-Hydroxy-1,2,3-propanetricarboxylic acid, Citric acid', '2-Hydroxybenzaldehyde, Salicylaldehyde', '2-Isobutyl-3-methoxypyrazine, 2-Methoxy-3-(2-methylpropyl)pyrazine', '2-Isopropenyl-5-methylcyclohexanol, Isopulegol, p-Menth-8-en-3-ol', '2-Isopropenyl-5-methylcyclohexyl acetate, Isopulegyl acetate', '2-Isopropyl-3-methoxypyrazine', '2-Isopropyl-5-methylcyclohexanol, Menthol', '2-Isopropyl-5-methylcyclohexyl acetate, Menthyl acetate', '2-Isopropyl-5-methylphenol, Thymol', '2-Isopropylidene-5-methylcyclohexanone, Pulegone, p-Menth-4(8)-en-3-one', '2-Isopropylphenol, o-Cumenol', '2-Mercaptopropionic acid, Thiolactic acid', '2-Methoxy-3-(1-methylpropyl)pyrazine, 2-(2-Butyl)-3-methoxypyrazine', '2-Methoxy-4-(1-propenyl)phenol, Isoeugenol', '2-Methoxyphenol, Guaiacol', '2-Methyl-1-butanethiol', '2-Methyl-1-propanol, Isobutyl alcohol', '2-Methyl-4-phenyl-2-butanol, 1,1-Dimethyl-3-phenyl-1-propanol, Benzyl-t-butanol', '2-Methylanisole, 2-Methoxytoluene', '2-Methylbenzaldehyde, o-Tolualdehyde', '2-Methylbutanal, 2-Methylbutyraldehyde', '2-Methylbutyric acid', '2-Methylpentanal, 2-Methylvaleraldehyde', '2-Methylphenol, o-Cresol', '2-Methylpropanal, Isobutyraldehyde', '2-Methylpropanoic acid, Isobutyric acid', '2-Methylpropyl formate, Isobutyl formate', '2-Methylpyrazine', '2-Methylundecanal, 2-Methylhendecanal', '2-Nonanol', '2-Nonanone', '2-Octanol', '2-Octanone', '2-Oxobutanoic acid, 2-Ketobutyric acid', '2-Pentanol', '2-Pentanone', '2-Phenyl-1-propanol, Hydratropyl alcohol', '2-Phenylethanol, Phenethyl alcohol', '2-Phenylethylamine, Phenethylamine', '2-Phenylpropionaldehyde, Hydratropaldehyde', '2-Phenylpropyl 2-methylpropanoate, Hydratropyl isobutyrate', '2-Phenylpropyl butyrate, Hydratropyl butyrate', '2-Propanol, Isopropyl alcohol', '2-Propylphenol', '2-Undecanone, 2-Hendecanone', "3',5'-Dihydroxyacetophenone", '3,4-Dihydro-2H-1-benzopyran-2-one, Dihydrocoumarin', '3,4-Dimethoxybenzaldehyde, Veratraldehyde', '3,4-Dimethoxystyrene', '3,4-Dimethylphenol, 3,4-Xylenol', '3,4-Methylenedioxybenzaldehyde, Piperonal', '3,4-Methylenedioxybenzyl 2-methylpropanoate, Piperonyl isobutyrate', '3,5,5-Trimethyl-2-cyclohexen-1-one, Isophorone', '3,7,11-Trimethyl-1,6,10-dodecatrien-3-ol, Nerolidol', '3,7,11-Trimethyl-2,6,10-dodecatrien-1-ol, Farnesol', '3,7-Dimethyl-1,6-octadien-3-ol, Linalool', '3,7-Dimethyl-1H-purine-2(3H),6(7H)-dione, 3,7-Dimethylxanthine, Theobromine', '3,7-Dimethyl-2,6-octadienal, Citral, Geranial + Neral', '3,7-Dimethyl-6-octen-1-ol, (b)-Citronellol', '3,7-Dimethyl-6-octenal, Citronellal', '3-(2-Furyl)-2-propenal, 3-(2-Furyl)acrolein', '3-(Methylthio)propanal, Methional', '3-Acetyl-2,5-dimethylthiophene', '3-Acetylpyridine', '3-Ethoxy-4-hydroxybenzaldehyde, Ethyl vanillin', '3-Ethylpyridine', '3-Heptanol', '3-Heptanone', '3-Hexanol', '3-Hexanone', '3-Hydroxy-2-butanone, Acetoin', '3-Methoxy-4-acetoxybenzaldehyde, Vanillin acetate', '3-Methyl-1-butanol, Isoamyl alcohol', '3-Methyl-2-butanol', '3-Methyl-2-buten-1-ol, Prenol', '3-Methyl-2-butenoic acid, 3-Methylcrotonic acid, Senecioic acid', '3-Methyl-2-cyclohexen-1-one', '3-Methyl-2-cyclopenten-1-one, 1-Methyl-1-cyclopenten-3-one', '3-Methylbenzaldehyde, m-Tolualdehyde', '3-Methylbutanoic acid, Isovaleric acid', '3-Methylbutyl acetate, Isoamyl acetate', '3-Methylbutylamine, Isoamylamine', '3-Methylbutyraldehyde, 3-Methylbutanal, Isovaleraldehyde', '3-Methylcyclopentane-1,2-dione, Methylcyclopentenolone', '3-Methylindole, Skatole', '3-Methylpentanoic acid', '3-Methylphenol, m-Cresol', '3-Nonanone', '3-Octanol']


csv_file = '../res/component_identification_mirrored_10%_200.csv'

with open(csv_file, 'w', newline='') as f:
    writer = csv.writer(f)

    for epoch in range(1):
        model.eval()

        for i, data in enumerate(test_dataloader, 0):
            inputs = data

            outputs = model(inputs)

            top_values, top_indices = torch.topk(outputs.view(-1), k=5)

            # Prepare the row data as a list
            row_data = []
            for j in range(5):
                row_data.extend([lib[top_indices[j]], float(top_values[j])])

            # Write the row data to the CSV file
            writer.writerow(row_data)
